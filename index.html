function applyG2PMapping(text, ipa) {
  const result = [];
  let ipaIndex = 0;
  let i = 0;
  const lowerText = text.toLowerCase();

  // Predefined mappings for G2P
  const g2pMappings = {
    "bb": "bː",
    "cc": "kː",
    "dd": "dː",
    "ff": "fː",
    "ll": "ː",   // Handling 'll' -> ː as per your example
    "mm": "ː",   // Handling 'mm' -> ː
    "nn": "ː",   // Handling 'nn' -> ː
    "pp": "ː",   // Handling 'pp' -> ː
    "qq": "qq",  // No change for 'qq'
    "rr": "rː",
    "ss": "sː",
    "tt": "tː",
    "gg": "dʒː", // Handling 'gg' -> dʒː
    "zz": "tsː", // Handling 'zz' -> tsː (or 'dzː' depending on context)
  };

  // Helper function to check if IPA sequence starts with certain patterns
  function startsWithIpa(ipa, pattern) {
    const variations = [`${pattern}`, `ˈ${pattern}`, `ˌ${pattern}`, `\u200D${pattern}`, `ˈ\u200D${pattern}`, `\u200Dˈ${pattern}`];
    for (const variant of variations) {
      if (ipa.startsWith(variant)) return { match: variant, len: variant.length };
    }
    return null;
  }

  // Helper function to check if a sound is followed by a vowel or specific characters
  function isFollowedByVowel(ipa, index) {
    const following = ipa.slice(index + 2); // Skip 'ː' and check the following character
    return following.startsWith('i') || following.startsWith('ˈi') || following.startsWith('j') || following.startsWith('ˈj') ||
           following.startsWith('e') || following.startsWith('ˈe') || following.startsWith('ɛ') || following.startsWith('ˈɛ');
  }

  // Process word by word, checking for matching IPA sequences
  while (i < text.length && ipaIndex < ipa.length) {
    const letter = text[i];
    let ipaChar = ipa[ipaIndex];

    // Check for 'tʃː' or 'dʒː' and apply the custom transformation if the conditions are met
    if (ipaChar === 't' && ipa[ipaIndex + 1] === 'ʃ' && ipa[ipaIndex + 2] === 'ː') {
      if (!isFollowedByVowel(ipa, ipaIndex)) {
        result.push(`cci(${ipaChar}ʃː)`);  // Map 'tʃː' to 'cci'
        i += 3;
        ipaIndex += 3;
        continue;
      }
    } else if (ipaChar === 'd' && ipa[ipaIndex + 1] === 'ʒ' && ipa[ipaIndex + 2] === 'ː') {
      if (!isFollowedByVowel(ipa, ipaIndex)) {
        result.push(`ggi(${ipaChar}ʒː)`);  // Map 'dʒː' to 'ggi'
        i += 3;
        ipaIndex += 3;
        continue;
      }
    }

    // Check predefined G2P mappings for common letter pairs
    const mappedIpa = g2pMappings[lowerText.slice(i, i + 2)];
    if (mappedIpa) {
      result.push(`${text.slice(i, i + 2)}(${mappedIpa})`);
      i += 2;
      ipaIndex += mappedIpa.length;
      continue;
    }

    // Default behavior: Process the IPA character normally
    if (ipaChar === 'ˈ' || ipaChar === 'ˌ') {
      ipaIndex++;
      ipaChar = ipa[ipaIndex];
      result.push(`${letter}('${ipaChar})`);
    } else {
      result.push(`${letter}(${ipaChar})`);
    }

    ipaIndex++;
    i++;
  }

  // If any remaining characters in the original text, append with empty IPA
  while (i < text.length) {
    result.push(`${text[i]}()`);
    i++;
  }

  return result.join(' ');
}
