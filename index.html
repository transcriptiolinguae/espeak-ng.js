<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Italian to IPA</title>
</head>
<body>
  <h2>Italian â†’ IPA (eSpeak NG WASM)</h2>
  <textarea id="text" rows="4" cols="50">ciao come stai</textarea><br>
  <button id="convert">Convert</button>
  <pre id="output">[IPA transcription will appear here]</pre>

  <script type="module">
    import ESpeakNG from './espeak-ng.js';

    let espeak;

    ESpeakNG().then(instance => {
      espeak = instance;
      console.log("eSpeak NG WASM loaded");
    });

    document.getElementById("convert").addEventListener("click", () => {
      if (!espeak) {
        alert("eSpeak NG is still loading...");
        return;
      }

      const inputText = document.getElementById("text").value;

      // Clean FS first
      try {
        espeak.FS_unlink("/output.txt");
      } catch (e) {}

      // Write input text to a file in the WASM virtual FS
      espeak.FS.writeFile("/input.txt", inputText);

      // Run eSpeak with arguments
      espeak.callMain([
        "-v", "it",
        "--ipa=3",
        "-f", "/input.txt",
        "--phonout", "/output.txt"
      ]);

      // Read the resulting IPA output
      try {
        const ipa = espeak.FS.readFile("/output.txt", { encoding: "utf8" });
        document.getElementById("output").innerText = ipa;
      } catch (e) {
        document.getElementById("output").innerText = "[Failed to read IPA output]";
        console.error(e);
      }
    });
  </script>
</body>
</html>
